<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fênix Racing FSAE - Analysis</title>
    <link href="/samples/assets/styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
        #chart_susp1, #chart_susp2, #chart_susp3, #chart_susp4 {
      max-width: 98%;
      margin: 35px auto;
      border: 2px solid black;
    }

        .navbar {
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
        }
    </style>


    <script>
      window.Promise ||
        document.write(
          '<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>'
        )
      window.Promise ||
        document.write(
          '<script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20171210/classList.min.js"><\/script>'
        )
      window.Promise ||
        document.write(
          '<script src="https://cdn.jsdelivr.net/npm/findindex_polyfill_mdn"><\/script>'
        )
    </script>
    </head>
<body>

    <script type="module">

        // VARIÁVEIS GLOBAIS -------------------------------------------------------------------------------------------
        var data_susp1 = [];
        var data_susp2 = [];
        var data_susp3 = [];
        var data_susp4 = [];
		var data_acc = [];
		
		var vector_keys = [];
		var last_key;

        var contador = 0;
		var first_time_here = 0;

		//Suspensão
        var susp1 = 0;
        var susp2 = 0;
        var susp3 = 0;
        var susp4 = 0;
		
		// Temperatura
        var temp1 = 0;
        var temp2 = 0;
        var temp3 = 0;
		
		// Dados gerais
        var rpm = 0;
        var velocidade = 0;
        var temp_motor = 0;
        var volante = 0;
		
		// Acelerômetro
        var acc_x = 0;
        var acc_y = 0;
        var acc_z = 0;
		
		// Timestamp
        var timestamp = 1327359600000;
		var dateObject = 0;
		var hours = 0;
		var minutes = 0;
		var seconds = 0;


        // CONFIGURAÇÕES DO GRÁFICO 01 ---------------------------------------------------------------------------------
        function getNewSeries() {
            // Esse "for" tem a única finalidade de "zerar" os dados que não aparecem no gráfico para evitar overflow.
            //for(var i = 0; i< data.length - 500; i++) {
            //    data[i].x = 0
            //    data[i].y = 0
            //}

            // É aqui que a mágica acontece, o contador e o dado da suspensão vão para o vetor que mostrará as coisas!

            data_susp1.push({
              x: contador,
              y: susp1
            })
            data_susp2.push({
              x: contador,
              y: susp2
            })
            data_susp3.push({
              x: contador,
              y: susp3
            })
            data_susp4.push({
              x: contador,
              y: susp4
            })
			data_acc.push({
              x: contador,
              y1: acc_x,
			  y2: acc_y,
			  y3: acc_z
            })
        }

        var options_susp1 = {
              series: [{data: data_susp1.slice()}],  // Pega os dados "cadastrados" com a função anterior e joga no gráfico.
              chart: { id: 'realtime', height: 300, type: 'line', animations: {
                enabled: false, easing: 'linear', dynamicAnimation: {
                  speed: 0
                    }
                },
              toolbar: { show: false }, // Gráficos ao vivo não consegue suportar o toolbar
              zoom: { enabled: false }  // Gráficos ao vivo não consegue suportar o zoom
              },
            dataLabels: { enabled: false },
            xaxis: { type: 'numeric', range: 100 },
            yaxis: { max: 1024 },
            legend: { show: false },
            stroke: { curve: 'straight', width: 1},
            title: { text: 'Front-Right suspension', align: 'left' }
        };

        var options_susp2 = {
              series: [{data: data_susp2.slice()}],  // Pega os dados "cadastrados" com a função anterior e joga no gráfico.
              chart: { id: 'realtime', height: 300, type: 'line', animations: {
                enabled: true, easing: 'linear', dynamicAnimation: {
                  speed: 10000
                    }
                },
              toolbar: { show: false }, // Gráficos ao vivo não consegue suportar o toolbar
              zoom: { enabled: false }  // Gráficos ao vivo não consegue suportar o zoom
              },
            dataLabels: { enabled: false },
            xaxis: { type: 'numeric', range: 100 },
            yaxis: { max: 1024 },
            legend: { show: false },
            stroke: { curve: 'straight', width: 1},
            title: { text: 'Front-Left suspension', align: 'left' }
        };

        var options_susp3 = {
              series: [{data: data_susp3.slice()}],  // Pega os dados "cadastrados" com a função anterior e joga no gráfico.
              chart: { id: 'realtime', height: 300, type: 'line', animations: {
                enabled: true, easing: 'linear', dynamicAnimation: {
                  speed: 10000
                    }
                },
              toolbar: { show: false }, // Gráficos ao vivo não consegue suportar o toolbar
              zoom: { enabled: false }  // Gráficos ao vivo não consegue suportar o zoom
              },
            dataLabels: { enabled: false },
            xaxis: { type: 'numeric', range: 100 },
            yaxis: { max: 1024 },
            legend: { show: false },
            stroke: { curve: 'straight', width: 1},
            title: { text: 'Back-Right suspension', align: 'left' }
        };

        var options_susp4 = {
              series: [{data: data_susp4.slice()}],  // Pega os dados "cadastrados" com a função anterior e joga no gráfico.
              chart: { id: 'realtime', height: 300, type: 'line', animations: {
                enabled: true, easing: 'linear', dynamicAnimation: {
                  speed: 10000
                    }
                },
              toolbar: { show: false }, // Gráficos ao vivo não consegue suportar o toolbar
              zoom: { enabled: false }  // Gráficos ao vivo não consegue suportar o zoom
              },
            dataLabels: { enabled: false },
            xaxis: { type: 'numeric', range: 100 },
            yaxis: { max: 1024 },
            legend: { show: false },
            stroke: { curve: 'straight', width: 1},
            title: { text: 'Back-left suspension', align: 'left' }
        };
		
		var acc = {
              series: [{data: data_susp4.slice()}],  // Pega os dados "cadastrados" com a função anterior e joga no gráfico.
              chart: { id: 'realtime', height: 300, type: 'line', animations: {
                enabled: true, easing: 'linear', dynamicAnimation: {
                  speed: 10000
                    }
                },
              toolbar: { show: false }, // Gráficos ao vivo não consegue suportar o toolbar
              zoom: { enabled: false }  // Gráficos ao vivo não consegue suportar o zoom
              },
            dataLabels: { enabled: false },
            xaxis: { type: 'numeric', range: 100 },
            yaxis: { max: 1024 },
            legend: { show: false },
            stroke: { curve: 'straight', width: 1},
            title: { text: 'Back-left suspension', align: 'left' }
        };

        var chart_susp1 = new ApexCharts(document.querySelector("#chart_susp1"), options_susp1);
        chart_susp1.render();

        var chart_susp2 = new ApexCharts(document.querySelector("#chart_susp2"), options_susp2);
        chart_susp2.render();

        var chart_susp3 = new ApexCharts(document.querySelector("#chart_susp3"), options_susp3);
        chart_susp3.render();

        var chart_susp4 = new ApexCharts(document.querySelector("#chart_susp4"), options_susp4);
        chart_susp4.render();
		
		var chart_acc = new ApexCharts(document.querySelector("#chart_acc"), options_acc);
        chart_acc.render();

        window.setInterval(function () {
            getNewSeries()
            chart_susp1.updateSeries([{ data: data_susp1 }])
            chart_susp2.updateSeries([{ data: data_susp2 }])
            chart_susp3.updateSeries([{ data: data_susp3 }])
            chart_susp4.updateSeries([{ data: data_susp4 }])
			chart_acc.updateSeries([{ data: data_acc }])
        })


    // CONFIGURAÇÃO DO FIREBASE ---------------------------------------------------------------------------------------
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-analytics.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyD2XEvG3AEahM5jz4xFmqO9Usrw2wfFNro",
            authDomain: "fenix-racing-bot.firebaseapp.com",
            databaseURL: "https://fenix-racing-bot-default-rtdb.firebaseio.com",
            projectId: "fenix-racing-bot",
            storageBucket: "fenix-racing-bot.appspot.com",
            messagingSenderId: "344990826933",
            appId: "1:344990826933:web:48516885130165330d59fc",
            measurementId: "G-F194GYR0RF"
          };

       // Initialize Firebase
       const app = initializeApp(firebaseConfig);
       const analytics = getAnalytics(app);
       // Get a reference to the database service
       const database = getDatabase(app);
       const db = getDatabase();

       var starCountRef = ref(db, 'packages')

       onValue(starCountRef, (snapshot) => {
			 if(first_time_here == 0)
			{
				contador = Object.keys(snapshot.val()).length;
				contador = contador - 1;
				first_time_here = 1;
			}
			if(contador < 0)
			{
				contador = 0;
			}
			
			vector_keys = Object.keys(snapshot.val());
			last_key = vector_keys[(vector_keys.length-1)];

			// Suspensão
            susp1 = snapshot.child(last_key).child('susp1').val();
			susp2 = snapshot.child(last_key).child('susp2').val();
			susp3 = snapshot.child(last_key).child('susp3').val();
			susp4 = snapshot.child(last_key).child('susp4').val();
			
			// Acelerômetro
			acc_x = snapshot.child(last_key).child('acc_x').val();
			acc_y = snapshot.child(last_key).child('acc_y').val();
			acc_z = snapshot.child(last_key).child('acc_z').val();
			
			// Timestamp
			//dateObject = new Date((snapshot.child(last_key).child('timestamp').val() * 1000));
			//hours = dateObject.getHours();
			//minutes = "0" + dateObject.getMinutes();
			//seconds = "0" + dateObject.getSeconds();
			//imestamp = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
			//timestamp = dateObject;
			
			
			contador = contador + 1
        });

    </script>

        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <div class="navbar-header">
              <a class="navbar-brand" href="#">Fênix Racing Telemetry</a>
            </div>
            <ul class="nav navbar-nav">
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Realtime Data
                <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="index.html">Dashboard 01</a></li>
                  <li><a href="dash02.html">Dashboard 02</a></li>
                  <li><a href="dash03.html">Dashboard 03</a></li>
                </ul>
              </li>
              <li><a href="#">Data Analysis</a></li>
              <li><a href="#">Data download</a></li>
              <li><a href="#">About</a></li>
            </ul>
          </div>
        </nav>

        <div id="chart_susp1"></div>
        <div id="chart_susp2"></div>
        <div id="chart_susp3"></div>
        <div id="chart_susp4"></div>
		<div id="chart_acc"></div>


</body>
</html>